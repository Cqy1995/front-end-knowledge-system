#VUEçŸ¥è¯†ç‚¹æ€»ç»“

### ç”Ÿå‘½å‘¨æœŸ 
1. beforeCreate:æ­¤æ—¶dataï¼Œmethodè¿˜æ²¡æœ‰åˆå§‹åŒ–ï¼Œå¯ä»¥ä½¿ç”¨lodingã€‚  
2. Createdï¼šæ­¤æ—¶dataï¼Œmethodå·²ç»åˆå§‹åŒ–ï¼Œå¯ä»¥åœ¨æ­¤åˆå§‹åŒ–dataæ•°æ®åŠmethodæ–¹æ³•è‡ªæ‰§è¡Œã€‚  
3. beforMount:ç¼–è¯‘æ¨¡ç‰ˆåœ¨elä¸Šé¢æŒ‚è½½è™šæ‹ŸdomeèŠ‚ç‚¹ã€‚  
4. Mountedï¼šç¼–è¯‘æ¨¡ç‰ˆåœ¨elä¸Šé¢æŒ‚è½½çœŸå®çš„domeèŠ‚ç‚¹ã€‚
5. beforeUpdate:æ•°æ®æ›´æ–°æ—¶è§¦å‘ï¼Œé‡æ–°æ¸²æŸ“è™šæ‹Ÿdomeã€‚
6. Updatedï¼šæ•°æ®æ›´æ–°å®Œæˆåè§¦å‘ã€‚  
7. beforeDestoryï¼šç»„ä»¶é”€æ¯å‰è§¦å‘ï¼Œæ­¤æ—¶watchersï¼Œå­ç»„ä»¶å’Œäº‹ä»¶é”€æ¯ã€‚  
8. Destoryedï¼šç»„ä»¶é”€æ¯åè§¦å‘ã€‚ 


### ç»„ä»¶ä¼ å€¼
1. é€šè¿‡proposä¼ é€’  
2. é€šè¿‡$emitè§¦å‘è‡ªå®šä¹‰äº‹ä»¶
3. ä½¿ç”¨ref
4. EventBus
bus.js  
```
// åˆ›å»ºä¸€ä¸ªä¸­å¤®æ—¶é—´æ€»çº¿ç±»
class Bus {
  constructor() {
    this.callbacks = {};   // å­˜æ”¾äº‹ä»¶çš„åå­—
  }
  $on(name, fn) {
    this.callbacks[name] = this.callbacks[name] || [];
    this.callbacks[name].push(fn);
  }
  $emit(name, args) {
    if (this.callbacks[name]) {
      this.callbacks[name].forEach((cb) => cb(args));
    }
  }
}

// main.js
Vue.prototype.$bus = new Bus() // å°†$busæŒ‚è½½åˆ°vueå®ä¾‹çš„åŸå‹ä¸Š
// å¦ä¸€ç§æ–¹å¼
Vue.prototype.$bus = new Vue() // Vueå·²ç»å®ç°äº†Busçš„åŠŸèƒ½
```
children1.vue  
```
this.$bus.$emit('foo')
```
children2.vue
```
this.$bus.$on('foo',this.handle);
```
5. parentæˆ–root
å…„å¼Ÿç»„ä»¶  
```
this.$parent.emit('add')
```
å¦ä¸€ä¸ªå…„å¼Ÿç»„ä»¶  
```
this.$parent.on('add',this.add)
```
6. attrsä¸listeners
```
//child:å¹¶æœªåœ¨propsä¸­å£°æ˜foo
<p>{{$attrs.foo}}</p>
//parent 
<HelloWord foo="foo"/>
```
```
// ç»™Grandsonéš”ä»£ä¼ å€¼ï¼Œcommunication/index.vue
<Child2 msg="lalala" @some-event="onSomeEvent"></Child2>

// Child2åšå±•å¼€
<Grandson v-bind="$attrs" v-on="$listeners"></Grandson>

// Grandsonä½¿â½¤
<div @click="$emit('some-event', 'msg from grandson')">
{{msg}}
</div>
```
7. Provideä¸Inject
ç¥–å…ˆç»„ä»¶å®šä¹‰   
```
provide(){
    return {
        foo:'foo'
    }
}
```
åä»£ç»„ä»¶  
```
inject:['foo']
```
8. å°ç»“  
çˆ¶å­å…³ç³»çš„ç»„ä»¶æ•°æ®ä¼ é€’é€‰æ‹© props  ä¸ $emitè¿›è¡Œä¼ é€’ï¼Œä¹Ÿå¯é€‰æ‹©ref  
å…„å¼Ÿå…³ç³»çš„ç»„ä»¶æ•°æ®ä¼ é€’å¯é€‰æ‹©$busï¼Œå…¶æ¬¡å¯ä»¥é€‰æ‹©$parentè¿›è¡Œä¼ é€’  
ç¥–å…ˆä¸åä»£ç»„ä»¶æ•°æ®ä¼ é€’å¯é€‰æ‹©attrsä¸listenersæˆ–è€… Provideä¸ Inject  
å¤æ‚å…³ç³»çš„ç»„ä»¶æ•°æ®ä¼ é€’å¯ä»¥é€šè¿‡vuexå­˜æ”¾å…±äº«çš„å˜é‡  

### ç»„ä»¶ä¸Šå®ç°v-modle
1. propsæ¥æ”¶valueå±æ€§
2. æ–°çš„valueæ—¶$emitè§¦å‘inputäº‹ä»¶

### vueåŒå‘ç»‘å®šåŸç†
vueé‡‡ç”¨æ•°æ®åŠ«æŒ+å‘å¸ƒ-è®¢é˜…æ¨¡å¼å®ç°,é€šè¿‡Object.defineProperty()æ¥åŠ«æŒå„ä¸ªå±æ€§çš„getter,setter,åœ¨æ•°æ®å˜åŒ–æ—¶å‘å¸ƒæ¶ˆæ¯ç»™è®¢é˜…è€…,è§¦å‘ç›¸åº”çš„ç›‘å¬å›è°ƒ.

mvvm çš„åŒå‘ç»‘å®š:
1. æ•°æ®åŠ«æŒ,å®ç°æ•°æ®ç›‘å¬å™¨Observer,å¯¹æ•°æ®å¯¹è±¡æ‰€æœ‰å±æ€§è¿›è¡Œç›‘å¬,ä¸€æ—¦æ”¹å˜æ‹¿åˆ°æœ€æ–°å€¼å¹¶é€šçŸ¥è®¢é˜…è€…
2. æ¨¡ç‰ˆçš„ç¼–è¯‘,å®ç°æŒ‡ä»¤è§£æå™¨complie,å¯¹æ¯ä¸ªèŠ‚ç‚¹æŒ‡ä»¤è¿›è¡Œæ‰«æå’Œè§£æ,æ ¹æ®æŒ‡ä»¤æ¨¡æ¿æ›¿æ¢æ•°æ®,å·²ç»ç»‘å®šç›¸åº”çš„æ›´æ–°å‡½æ•° 
3. å®ç°ä¸€ä¸ªWatcher,ä½œä¸ºObserverå’Œcomplieçš„æ¡¥æ¢,
    - èƒ½å¤Ÿè®¢é˜…å¹¶æ¥æ”¶æ¯ä¸ªå±æ€§å˜åŠ¨çš„é€šçŸ¥(åœ¨è‡ªèº«å®ä¾‹åŒ–æ—¶å¾€å±æ€§è®¢é˜…å™¨(dep)é‡Œé¢æ·»åŠ è‡ªå·±)
    - æ‰§è¡ŒæŒ‡ä»¤ç»‘å®šç›¸åº”çš„å›è°ƒå‡½æ•°(å¾…å±æ€§å˜åŒ–dep.notify()é€šçŸ¥æ—¶,è°ƒç”¨è‡ªèº«update,å¹¶ä¸”è§¦å‘compileç»‘å®šçš„å›è°ƒ)
    - æ›´æ–°è§†å›¾(è‡ªèº«å¿…é¡»æœ‰ä¸€ä¸ªupdateæ–¹æ³•)
4. æ”¶é›†è®¢é˜…è€…,é€šçŸ¥è®¢é˜…è€…æ›´æ–°

![vue mvvm](https://raw.githubusercontent.com/Cqy1995/front-end-knowledge-system/main/images/vue-mvvm.png)

```
// ä¸Šæ–‡çœç•¥...
defineReactive(obj,key,value){
    // é€’å½’éå†
    this.observe(value)
    const dep = new Dep()
    Object.defineProperty(obj,key,{
      enumerable: true,
      configurable: false,
      get(){
        // è®¢é˜…æ•°æ®å±æ€§æ—¶ï¼Œå¾€Depä¸­æ·»åŠ è§‚å¯Ÿè€…ï¼Œè¿›è¡Œä¾èµ–æ”¶é›†
        Dep.target && dep.addSub(Dep.target)
        return value
      },
      // é€šè¿‡ç®­å¤´å‡½æ•°æ”¹å˜thisæŒ‡å‘åˆ°class Observer
      set:(newVal)=>{
        this.observe(newVal)
        if(newVal !== value){
          value = newVal
          // å¦‚æœæ–°æ—§å€¼ä¸åŒï¼Œåˆ™å‘Šè¯‰Depé€šçŸ¥å˜åŒ–
          dep.notify()
        }
      }
    })
  }

```
ğŸŒ¿å†æ¬¡æ¢³ç†ï¼š   
æœ€å¼€å§‹ï¼Œæˆ‘ä»¬å®ç°äº† Compile æ¥è§£ææŒ‡ä»¤ï¼Œæ‰¾åˆ° {{xxx}}ã€æŒ‡ä»¤ã€äº‹ä»¶ã€ç»‘å®šç­‰ç­‰ï¼Œç„¶åå†åˆå§‹åŒ–è§†å›¾ã€‚ä½†æ­¤æ—¶è¿˜æœ‰ä¸€ä»¶äº‹æƒ…æ²¡åšï¼Œå°±æ˜¯å½“æ•°æ®å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œåœ¨æ›´æ–°æ•°æ®ä¹‹å‰ï¼Œæˆ‘ä»¬è¿˜è¦è®¢é˜…æ•°æ®å˜åŒ–ï¼Œç»‘å®šæ›´æ–°å‡½æ•°ï¼Œæ­¤æ—¶å°±éœ€è¦åŠ å…¥è®¢é˜…è€…Watcheräº†ã€‚å½“è®¢é˜…è€…è§‚å¯Ÿåˆ°æ•°æ®å˜åŒ–æ—¶ï¼Œå°±ä¼šè§¦å‘Updateræ¥æ›´æ–°è§†å›¾ã€‚   

å½“ç„¶ï¼Œåˆ›å»º Watcherçš„å‰ææ—¶è¦è¿›è¡Œæ•°æ®åŠ«æŒæ¥ç›‘å¬æ‰€æœ‰å±æ€§ï¼Œæ‰€ä»¥åˆ›å»ºäº† Observer.js æ–‡ä»¶ã€‚åœ¨ getæ–¹æ³•ä¸­ï¼Œéœ€è¦ç»™ Dep é€šçŸ¥å˜åŒ–ï¼Œæ­¤æ—¶å°±éœ€è¦å°† Dep çš„ä¾èµ–æ”¶é›†å…³è”èµ·æ¥ï¼Œå¹¶ä¸”æ·»åŠ è®¢é˜…è€… Watcherï¼ˆè¿™ä¸ª Watcher åœ¨ Complie è®¢é˜…æ•°æ®å˜åŒ–ï¼Œç»‘å®šæ›´æ–°å‡½æ•°æ—¶å°±å·²ç»åˆ›å»ºäº†çš„ï¼‰ã€‚æ­¤æ—¶ Dep è®¢é˜…å™¨é‡Œå°±æœ‰å¾ˆå¤šä¸ª Watcher äº†ï¼Œæœ‰å¤šå°‘ä¸ªå±æ€§å°±å¯¹åº”æœ‰å¤šå°‘ä¸ª Watcherã€‚  

é‚£ä¹ˆï¼Œæˆ‘ä»¬ä¸¾ä¸€ä¸ªç®€å•ä¾‹å­æ¥èµ°ä¸€ä¸‹ä¸Šè¿°æµç¨‹å›¾ï¼š   

å‡è®¾åŸæœ¬ data æ•°æ®ä¸­æœ‰ä¸€ä¸ª a:1ï¼Œæ­¤æ—¶æˆ‘ä»¬è¿›è¡Œæ›´æ–°ä¸º a:10ï¼Œç”±äºæ—©å·²ç»å¯¹æˆ‘ä»¬çš„æ•°æ®è¿›è¡Œäº†æ•°æ®åŠ«æŒå¹¶ä¸”ç›‘å¬äº†æ‰€æœ‰å±æ€§ï¼Œæ­¤æ—¶å°±ä¼šè§¦å‘ set æ–¹æ³•ï¼Œåœ¨ setæ–¹æ³•é‡Œå°±ä¼šé€šçŸ¥ Dep è®¢é˜…å™¨å‘ç”Ÿäº†å˜åŒ–ï¼Œç„¶åå°±ä¼šé€šçŸ¥ç›¸å…³ Watcher è§¦å‘ update å‡½æ•°æ¥æ›´æ–°è§†å›¾ã€‚è€Œè¿™äº›è®¢é˜…è€… Watcher åœ¨ Complie è®¢é˜…æ•°æ®å˜åŒ–ï¼Œç»‘å®šæ›´æ–°å‡½æ•°æ—¶å°±å·²ç»åˆ›å»ºäº†ã€‚

ğŸŒ¿æœ€ç»ˆæ¢³ç†:

vue.js åˆ™æ˜¯é‡‡ç”¨æ•°æ®åŠ«æŒç»“åˆå‘å¸ƒè€…-è®¢é˜…è€…æ¨¡å¼çš„æ–¹å¼ï¼Œé€šè¿‡ Object.defineProperty()æ¥åŠ«æŒå„ä¸ªå±æ€§çš„getterï¼Œsetterï¼Œåœ¨æ•°æ®å˜åŠ¨æ—¶å‘å¸ƒæ¶ˆæ¯ç»™è®¢é˜…è€…ï¼Œè§¦å‘ç›¸åº”çš„ç›‘å¬å›è°ƒã€‚   

MVVMä½œä¸ºæ•°æ®ç»‘å®šçš„å…¥å£ï¼Œæ•´åˆObserverã€Compile å’Œ Watcher ä¸‰è€…ï¼Œé€šè¿‡Observeræ¥ç›‘å¬è‡ªå·±çš„modelæ•°æ®å˜åŒ–ï¼Œé€šè¿‡Compileæ¥è§£æç¼–è¯‘æ¨¡æ¿æŒ‡ä»¤ï¼Œæœ€ç»ˆåˆ©ç”¨Watcheræ­èµ·Observerå’ŒCompileä¹‹é—´çš„é€šä¿¡æ¡¥æ¢ï¼Œè¾¾åˆ°æ•°æ®å˜åŒ– -> è§†å›¾æ›´æ–°ï¼›è§†å›¾äº¤äº’å˜åŒ–(input) -> æ•°æ®modelå˜æ›´çš„åŒå‘ç»‘å®šæ•ˆæœã€‚   

### åŒå‘ç»‘å®šä¹‹æ•°ç»„
```
const arrayProto = Array.prototype
const arrayMethods = Object.create(arrayProto)
;[
  'push',
  'pop',
  'shift',
  'unshift',
  'splice',
  'sort',
  'reverse'
].forEach(item=>{
	Object.defineProperty(arrayMethods,item,{
	    value:function mutator(){
	    	//ç¼“å­˜åŸç”Ÿæ–¹æ³•ï¼Œä¹‹åè°ƒç”¨
	    	const original = arrayProto[item]	
	    	let args = Array.from(arguments)
		    original.apply(this,args)
		    const ob = this.__ob__
		    ob.dep.notify()
	    },
	})
})
```

### this.$nextTickåŸç†
å½“domæ›´æ–°æ¸²æŸ“å®Œæˆåè§¦å‘  
**vueæ¸²æŸ“æ˜¯å¼‚æ­¥çš„,æ›´æ–°æ•°æ®domä¸æ˜¯ç«‹å³æ¸²æŸ“**
- è§¦å‘äº‹ä»¶,åˆ›å»ºä¸€ä¸ªæ‰§è¡Œæ ˆ,åŒæ­¥ä»£ç æ ¹æ®æ‰§è¡Œæ ˆæ‰§è¡Œ,æ­¤æ—¶ä¸æ›´æ–°dom
- å¼‚æ­¥ä»£ç æ¨é€åˆ°é˜Ÿåˆ—ä¸­,å¦‚æœé‡åˆ°ç›¸åŒçš„æ›´æ–°domæ“ä½œ,åªä¼šä¿ç•™ä¸€ä¸ª
- åŒæ­¥æ‰§è¡Œæ ˆä»»åŠ¡æ‰§è¡Œå®Œæ¯•å,æ‰§è¡Œå¼‚æ­¥é˜Ÿåˆ—ä»»åŠ¡,æ­¤æ—¶æ‰æ›´æ–°demo
- ç„¶åè§¦å‘nexttickå›è°ƒ