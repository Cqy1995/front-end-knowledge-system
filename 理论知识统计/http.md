
# 图解HTTP阅读总结


### 请求方法
get:获取资源  
post:传输实体实力  
put:传输文件  
delete:删除文件  
head:获取报文首部,不返回主体内容  
options:询问支持哪些方法  
trace:追踪路径  
connect:要求用轨道协议连接代理  
link:建立与资源的连接  

### http1.0与1.1的区别
1. tcp连接持久话在1.1中是标准,在1.0中并不是.
⚠️(持久话就是建立一次tcp,连接可以多吃请求响应数据,并不是每次请求响应数据都要发送关闭tcp连接,管线话可并行发送多个请求,比持久化连接更快)
2. 公共首部max-age在http1.0会被忽略使用expires,相反http1.1会使用max-age忽略expires
3. 公共首部Connection在http1.1之前需要使用Keep-Alive,保持持久连接

### http状态码
1xx 信息状态码，接收的请求正在处理    
2xx 成功状态码，接收请求正常处理  
3xx 重定向状态码，需要进行额外操作以完成请求  
4xx 客户端错误状态码，服务器无法处理请求  
5xx 服务端错误状态码，服务器处理请求失败  

### 常见http状态码
1. 204请求处理成功,但没有资源返回  
2. 206进行了范围请求
3. 301永久重定向
4. 302临时重定向
5. 304资源已找到,但未符合条件请求
6. 400请求语法错误
7. 401请求未认证
8. 403不允许访问资源,被服务器拒绝
9. 404服务器没有请求的资源
10. 500服务器发生错误
11. 503服务器处于超负载或停机维护

### cookie
由于http是无状态的,所以使用cookie
1. 在没有cookie信息状态时,在请求报文(request headers)中,首部字段没有cookie
2. 在服务端生成cookie,也就是在响应报文(response headers)中,首部字段set-cookie
3. 在请求时,在请求报文中添加首部字段cookie
4. 服务器检查cookie,做出响应  

##### 请求头分4类:通用首部、请求首部、响应首部和实体首部。
- 通用首部(请求报文与响应报文都会使用的首部)
    - Cache-Control:(缓存机制,属于强制缓存)可接受多个参数
        - **no-cache:客户端不会收的缓存过的响应,防止拿到过期的资源**
        - no-store:不能在本地存储或响应任一部分(指定缓存期限和认证指令)
        - public:表明其他用于也可以利用缓存
        - private:表明缓存只能对指定用户使用缓存
        - **max-age = xx(单位:秒):缓存存在的最长时间**
        - s-maxage= xx(单位:秒):功能相同,不同的是只适用于供多位用户使用公共缓存服务器(一般指代理)
        - min-fresh= xx(单位:秒):要求缓存服务器返回至少未指定时间的缓存资源
        - max-stale= xx(单位:秒):可指示缓存资源，即使过期也照常接收。
        - only-if-cached:仅在缓存服务器本地缓存目标资源的情况下才会要求其返回
        - must-revalidate:向源服务器再次验证即将返回的响应缓存目前是否有效
        - proxy-revalidate:指令要求所有的缓存服务器在接收到客户端带有该指令的请求返回响应之前，必须再次验证缓存的有效性
        - no-transform:指令无论是在请求还是响应中，缓存都不能改变实体主体的媒体类型,(防止缓存或代理压缩图片等类似操作)
    - Connection:管理持久连接,控制不再转发给代理的首部字段
        - close服务器端想明确断开连接
        - 在http1.1之前需要使用Keep-Alive,保持持久连接
    - Date:创建http报文的日期与时间
    - Pragma:是http1.1之前遗留的字段,要求所有中间服务器不返回缓存的资源(兼容)
        - no-cache是验证的定义pragma的唯一形式
    - Trailer:报文主体后记录了哪些首部字段(应用在http1.1版本分块传输编码)
    - Transfer-Encoding:传输报文主体时采用的编码方式
    - Upgrade:用于检测http协议及其他协议是否可使用更高的协议进行通信(可配合Connection使用)
    - Via:为了追踪客户端与服务器之间的请求和响应报文的传输路径
        - 注意:必须在经过代理时附加该首部字段内容,因为首部字段 Via 不仅用于追踪报文的转发，还可避免请求回环的发生。
        - 经常会和 TRACE 方法一起使用,比如，代理服务器接收到由 TRACE 方法发送过来的请求时，代理服务器就不能再转发该请求了,这种情况下，代理服务器会将自身的信息附加到 Via 首部后，返回该请求的响应。
    - Warning:告知用户一些与缓存相关的问题警告
        - 110:响应已过期
        - 111:再验证失败
        - 112:断开连接操作
        - 113:试探性过期
        - 199:杂项警告
        - 214:使用了转换
        - 299:持久项警告
- 请求首部字段:客户端往服务端发送请求报文中所使用的字段(用于补充请求的附加信息,客户端信息,对响应内容相关的优先级等)
    - Accept:用户代理能够处理的媒体类型及相对优先级,使用type/subtype形式,一次指定多种媒体类型.(使用q=来额外表示权重值,用;分号分割,范围在0~1(可精确到小数点后3位))
    - Accept-Charset:通知服务器用户代理支持的字符集及相对优先级(用于内容协商机制的服务器驱动协商)
    - Accept-Encoding:告知服务器用户代理支持的内容编码及优先级顺序,一次可指定多种.(q值表示权重,*作为通配符)
        - gzip:由文件压缩程序gzip生成的编码格式
        - compress:由UNIX文件压缩程序compress生成编码格式
        - deflate组合使用zlib格式及由deflate压缩算法生成的编码格式
        - identity不执行压缩或不会变化的默认格式
    - Accept-Language:告知服务器用户代理能够处理的自然语言集.
    - Authorization:告知服务器,用户代理的认证信息.
    - Expect:期望出现的某种特定行为.
    - From:告知服务器用户的电子邮件地址.
    - Host:告知服务器,请求资源所在的主机名和端口号(一个服务器下会有好多虚拟主机)
    - **_If-xx这种形式的请求首部字段,被称为条件请求.服务器接到附带条件的请求后,只有判断指定条件为真时,才执行请求_**
    - If-Match:告知服务器匹配资源所用的实体标记(ETag)值.服务器会比对 If-Match 的字段值和资源的 ETag 值，仅当两者一致时，才会执行请求。反之，则返回状态码 412.
    - If-None-Match:只有在If-None-Match的字段值与ETag值不一致时可处理该请求
    - **If-Modified-Since:如果在这个字段指定的日期时间后,资源发生变化,服务器会接受请求.(用于确认代理或客户端拥有的本地资源的有效性,属于协商缓存)**
    - If-Range:告知服务器,若指定的if-range值与请求资源的etag值或时间一致时,则进行范围请求.反之,则返回全体资源.
    - If-Unmodified-Since:与If-Modified-Since 的作用相反,指定的请求资源只有在字段值内指定的日期时间之后，未发生更新的情况下，才能处理请求。
    - Max-Forwards:当服务器接收到 Max-Forwards 值为 0 的请求时，则不再进行转发，而是直接返回响应。(限制转发)
    - Proxy-Authorization:告知服务器认证所需要的信息(前提:接收到从代理服务器发来的认证质询时)
    - Range:bytes=5001-10000,表示请求获取从第5001字节至第10000字节的资源
    - Referer:告知服务器请求的原始资源的 URI
    - TE:告知服务器客户端能够处理响应的传输编码方式及相对优先级。它和首部字段Accept-Encoding的功能很相像，但是用于传输编码。
    - User-Agent:用于传达浏览器的种类
- 响应首部字段:由服务器端向客户端返回响应报文中所使用的字段
    - Accept-Ranges:是否能处理范围请求
    - Age:源服务器在多久前创建了响应(单位/秒),如是缓存服务器,Age值是指缓存后的响应再次发起认证到认证完成的时间值 
    - **Etag:资源被缓存时,会分配唯一标识.(字符串的形式)**
        - 1.强ETag值,不论实体发生多少细微变化都会改变值.
        - 2.弱ETag值,只用于提示资源是否相同
    - Location:将响应接收方引导到某个与请求URL位置不同的资源.
    - Proxy-Authenticate 会把由代理服务器所要求的认证信息发送给客户端
    - Retry-After:告知客户端应该在多久之后再次发送请求
    - Server:告诉客户端当前服务器安装的http服务器应用程序的信息
    - Vary: 只能对持相同自然语言(Accept-Language)的请求返回缓存
    - WWW-Authenticate:用于HTTP 访问认证
- 实体首部字段:包含在请求报文和响应报文中实体部分所使用的首部.(用于补充内容的更新时间及实体相关的信息)
    - Allow:用于通知客户端能够支持Request-URl指定资源的所有HTTP方法.(当服务器接收到不支持的http方法时,以405作为响应返回)
    - Content-Encoding:告知客户端对实体的主体部分选用的内容编码方式.(内容编码是指在不丢失实体信息的前提下所进行的压缩)
        - gzip
        - compress
        - deflate
        - identity
    - Content-Language:告知客户端,实体主体使用的自然语言
    - Content-Length:实体主体部分的大小
    - Content-Location:与报文主体部分相对应的URL
    - Content-MD5:由MD5算法生成的值,其目的在于检查报文主体在传输过程中是否保持完整,以确认传输送达
    - Content-Range:告知客户端作为响应返回的实体的哪个部分符合范围请求 
    - Content-Type:实体的媒体类型
    - **Expires:告诉客户端资源失效的日期(如不想缓存,最好吧expires字段写入与首部字段Date相同的时间值)**
    - **Last-Modified:资源最终修改的时间**
- 为Cookie服务的首部字段,Cookie工作机制是用户识别及状态管理.
    - Set-Cookie:开始状态管理所使用的Cookie信息(响应首部字段)
        - NAME=VALUE,赋予Cookie名称与值
        - expires=DATE,有效期
        - path=PATH,服务器上文件目录作为cookie的适用对象
        - domain=域名,作为cookie适用对象的域名
        - Secure,仅在https安全通信才会发送cookie
        - HttpOnly,加以限制,使cookie不能被JavaScript脚本访问
    - Cookie:服务端接受到的Cookie信息(请求首部字段)
- 其他首部字段
    - X-Frame-Options,控制网站内容在其他网站的Frame标签内显示.(响应首部)
        - DENY:拒绝
        - SAMEORIGIN:仅在同源域名下的页面匹配时许可
    - X-XSS-Protection:针对跨站脚本攻击的对策.(响应首部)
        - 0:将XSS过滤设置成无效
        - 1:将XSS过滤设置成有效
    - DNT:拒绝个人信息被收集,表示拒绝被精准广告追踪(请求首部)
        - 0:同意被追踪
        - 1:拒绝被追踪
    - P3P:让web网站上的个人隐私变成一种仅供程序理解的形式,从而保护用户隐私